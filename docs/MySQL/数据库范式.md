有七个范式，我们只需要学习前三个便足够了。
参考文章：[数据库三范式说的到底是啥？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/409369727)
# 为什么需要范式（normal form）？
为了**标准化**。我们想让我们设计的表是最优的，没有冗余的数据。冗余的数据会让数据的更新变得复杂。标准化就是审查我们的设计是否有冗余的过程。
# 数据库三大范式
## 第一范式
**每个列必须是原子性的。**
举个例子。下面course表中的course_tags就不是原子性的。

| course_id | course_name | course_tags  |
| :---------: | :-----------: | :------------: |
| 1         | 数据库内核  | 底层，数据库 |  
## 第二范式
**非主属性必须完全依赖与主属性。**

| ==student_id== | ==course_id== | student_name | teacher_id |
| ---------- | --------- | ------------ | ---------- |
| 1          | 1         | 小明         | 1          |
|            |           |              |            | 

student_id 和 course_id是这张表的主键。
(student_id, course_id)两个值才能确定tearcher_id。teacher_id（非主属性）完全依赖于主键。
而student_id一个主属性就可以确定student_name。这就违反了第二范式。
## 第三范式
**在第二范式的基础上，消除对主属性的传递依赖。**

| ==student_id== | ==course_id== | teacher_id | teacher_name |
| ---------- | --------- | ------------ | ---------- |
| 1          | 1         | 1         | 小明          |
|            |           |              |            | 

显然，存在依赖关系（student_id, course_id）-> (teacher_id) -> (teacher_name)。teacher_name有对主属性的传递依赖。

# 忘记范式 
来源于：[05 表结构设计：忘记范式准则 (lianglianglee.com)](https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%98%E5%AE%9D%E5%85%B8/05%20%20%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%EF%BC%9A%E5%BF%98%E8%AE%B0%E8%8C%83%E5%BC%8F%E5%87%86%E5%88%99.md)
在工业中的表结构设计:
## 自增主键
自增主键BIGINT存在弊端。
- 存在回溯问题
- 在服务器端产生，存在并发问题。
- 只能保证在实例中唯一，不能保证全局唯一
- 安全问题。别人看到容易猜测到使用了自增主键。
- 分布式架构设计问题
![[Pasted image 20231225112147.png]]
自增需要锁，innodb_autoinc_lock_mode 用于控制自增锁持有的时间。可以把锁的范围定义为每条SQL语句（1）或每次插入（2）。显然把范围设置为每次插入，可以提高并发性能。但也导致一个SQL里的几次插入的主键不连续。
## UUID
用时间序列生成的全局唯一标识。32位。
## 自定义主键
UUID 虽好，但是在分布式数据库场景下，主键还需要加入一些额外的信息，这样才能保证后续二级索引的查询效率。
**现在你只需要牢记：分布式数据库架构，仅用 UUID 做主键依然是不够的。**
PK = 时间字段 + 随机码（可选） + 业务信息1 + 业务信息2 ......
## 消除冗余
进行表结构设计时，数据只需存放在一个地方，其他表要使用，通过主键关联存储即可。
## 反范式设计
比如Tags使用了JSON类型

## 总结

总的来说，范式是偏数据库理论范畴的表结构设计准则，在实际的工程实践上没有必要严格遵循三范式要求，**在 MySQL 海量并发的工程实践上，表结构设计应遵循这样几个规范：**

- 每张表一定要有一个主键；
- **自增主键只推荐用在非核心业务表**，甚至应避免使用；
- **核心业务表推荐使用 UUID 或业务自定义主键**；
- 一份数据应尽可能保留一份，通过主键关联进行查询，避免冗余数据；
- 在一些场景下，可以通过 JSON 数据类型进行反范式设计，提升存储效率；




